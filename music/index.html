<!DOCTYPE html>
<html>
    <head>
    <title>
        
            music | Nemophila | blog of 一之濑亚子 いちのせあこ
        
        
    </title>
    <meta charset="UTF-8">
    <link rel="icon" href="/ico/Nemo.svg" />
    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/css/all.min.css">

    <!-- 引入LaTex支持css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css">
    <!-- 引入APlayer支持css和js -->
    
<link rel="stylesheet" href="/css/APlayer.min.css">

    
<script src="/js/APlayer.min.js"></script>

    <!-- 引入Linking -->
    
<script src="/js/linking.js"></script>

    <!-- 引入vercount计数器 -->
    <script defer src="https://events.vercount.one/js"></script>
    <script>
        let HEXO_SETTINGS = {
            root: "/", 
            url: "https://nyaku.moe",
            author: "izNyaku"
        };

        let THEME_SETTINGS = {
            lazyload: {
                enable: true,
                loading_img: "/images/yachiyo_loading2_640.webp"
            },
            };        
    </script>
<meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="Nemophila | blog of 一之濑亚子 いちのせあこ" type="application/atom+xml">
</head>
    <body>  
    <div id= "music-page" class="music-container"
    style="--dark_mask_opacity: 0;
        --bg-brightness: 0.75">
     

<nav class="navbar theme--music">
    <a href="/" style="text-decoration: none;">
        <h1 class="title theme--music">Nemophila</h1> 
    </a>
    <div class="navlink theme--music">
        
            <div class="nav-item-container theme--music">
                <a href="/" class="navlink-item theme--music">
                    <div class="nav-icon theme--music" 
                        style="-webkit-mask-image: url('/ico/navbar/home.svg'); mask-image: url('/ico/navbar/home.svg');">
                     </div>
                    <span>首页</span>
                    
                    

                </a>
                
                

            </div>
        
            <div class="nav-item-container theme--music">
                <a href="javascript:void(0)" class="navlink-item theme--music">
                    <div class="nav-icon theme--music" 
                        style="-webkit-mask-image: url('/ico/navbar/archive.svg'); mask-image: url('/ico/navbar/archive.svg');">
                     </div>
                    <span>归档</span>
                    
                    
                        <i class="fa-solid fa-angle-down fa"></i>
                    

                </a>
                
                
                    <div class="nav-item-submenu theme--music">
                        
                            
                            
                            
                                
                            
                            <a href="/categories/tech/">
                                
                                    <i class="far fa-lightbulb" style="transform: translateY(15%); font-size: 14px;"></i>
                                
                                <span data-content="技术">技术</span>
                                
                            </a>
                        
                            
                            
                            
                                
                            
                            <a href="/categories/talk/">
                                
                                    <i class="fas fa-pen" style="transform: translateY(15%); font-size: 14px;"></i>
                                
                                <span data-content="杂谈">杂谈</span>
                                
                            </a>
                        
                            
                            
                            
                                
                            
                            <a href="/categories/note/">
                                
                                    <i class="far fa-note-sticky" style="transform: translateY(15%); font-size: 14px;"></i>
                                
                                <span data-content="笔记">笔记</span>
                                
                            </a>
                        
                    </div>
                

            </div>
        
            <div class="nav-item-container theme--music">
                <a href="javascript:void(0)" class="navlink-item theme--music">
                    <div class="nav-icon theme--music" 
                        style="-webkit-mask-image: url('/ico/navbar/list.svg'); mask-image: url('/ico/navbar/list.svg');">
                     </div>
                    <span>Lists</span>
                    
                    
                        <i class="fa-solid fa-angle-down fa"></i>
                    

                </a>
                
                
                    <div class="nav-item-submenu theme--music">
                        
                            
                            
                            
                                
                            
                            <a href="/bangumis/">
                                
                                    <i class="fas fa-tv" style="transform: translateY(15%); font-size: 14px;"></i>
                                
                                <span data-content="番组">番组</span>
                                
                            </a>
                        
                            
                            
                            
                                
                            
                            <a href="/music/">
                                
                                    <i class="far fa-headphones" style="transform: translateY(15%); font-size: 14px;"></i>
                                
                                <span data-content="音乐">音乐</span>
                                
                            </a>
                        
                    </div>
                

            </div>
        
            <div class="nav-item-container theme--music">
                <a href="/friends/" class="navlink-item theme--music">
                    <div class="nav-icon theme--music" 
                        style="-webkit-mask-image: url('/ico/navbar/heart.svg'); mask-image: url('/ico/navbar/heart.svg');">
                     </div>
                    <span>Friends</span>
                    
                    

                </a>
                
                

            </div>
        
            <div class="nav-item-container theme--music">
                <a href="javascript:void(0)" class="navlink-item theme--music">
                    <div class="nav-icon theme--music" 
                        style="-webkit-mask-image: url('/ico/navbar/coffee.svg'); mask-image: url('/ico/navbar/coffee.svg');">
                     </div>
                    <span>Project</span>
                    
                    
                        <i class="fa-solid fa-angle-down fa"></i>
                    

                </a>
                
                
                    <div class="nav-item-submenu theme--music">
                        
                            
                            
                            
                                
                            
                            <a target="_blank" rel="noopener" href="https://github.com/imouup/Nemophila">
                                
                                <span data-content="Nemophila">Nemophila</span>
                                
                            </a>
                        
                    </div>
                

            </div>
        
        <a href="/atom.xml" class="navlink-rss theme--music">
            <div class="nav-icon theme--music" 
                style="-webkit-mask-image: url('/ico/navbar/rss.svg'); mask-image: url('/ico/navbar/rss.svg');">
            </div>
        </a>
    </div>
    <a href="/search" class="search theme--music">
        <div class="nav-icon theme--music" 
            style="-webkit-mask-image: url('/ico/navbar/search.svg'); mask-image: url('/ico/navbar/search.svg');">
        </div>
    </a>
    
</nav>
    
        
    <div id="aplayer"></div>
</div>

<!-- 令footer消失 -->
<style>
    #footer {
        display: none;
    }
</style>

<!-- Metingjs -->
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

<script>
    // 设置背景函数
    const setbg = (coverUrl) => {
        let musicPage = document.getElementById('music-page');
        if (musicPage && coverUrl) {
            const loader = new Image();

            musicPage.style.setProperty('--bg-brightness', 0);
            musicPage.style.setProperty('--dark_mask_opacity', 1);

            musicPage.style.setProperty('--music-bg-img', `url('${coverUrl}')`);
             
            loader.onload = ()=>{
                musicPage.style.setProperty('--bg-brightness', 0.75);
                musicPage.style.setProperty('--dark_mask_opacity', 0);
            }
            loader.src = coverUrl;
        }
    }

    const bgchanger = (player) => {
        if (player.list.audios.length > 0)
        {
            const currentAudio = player.list.audios[player.list.index];
            setbg(currentAudio.cover);
        }

        player.on('listswitch', (data) => {
            const nextAudio = player.list.audios[data.index];
            if (nextAudio && nextAudio.cover) {
                setbg(nextAudio.cover);
            }
        });
    }



    
    // 初始化Aplayer对象
    const playerType = 'aplayer';
    const audioList = [{"name":"Remember","artist":"Yachiyo","url":"https://music.163.com/song/media/outer/url?id=3340112781.mp3","cover":"images/music_cover_test.jpg","lrc":"assets/Remember.lrc"},{"name":"Remember","artist":"Yachiyo","url":"https://music.163.com/song/media/outer/url?id=3340112781.mp3","cover":"images/music_cover_test.jpg","lrc":"assets/Remember.lrc"}];

    const urlConvert = (url) =>{
        if (url) {
            if (url.startsWith('http') || url.startsWith('//')) {
                return url;
            }
            const cleanUrl = url.replace(/^\/+/, '');
            let origin = window.location.origin;
            let finalurl = origin + HEXO_SETTINGS.root + cleanUrl;
            return finalurl;
        } 
        return '';
        
    }

    audioList.forEach((audio)=>{
        audio.url = urlConvert(audio.url);
        audio.cover = urlConvert(audio.cover);
        if (audio.lrc) {
            audio.lrc = urlConvert(audio.lrc);
        }
        
    });


    if (playerType && playerType === 'aplayer' && audioList.length>0) {
        console.log('aplayer initialized')

    const musicPlayerA = new APlayer({
        container: document.getElementById('aplayer'),
        lrcType: 3,
        audio: audioList

    });

    bgchanger(musicPlayerA);

    // //修正歌词滚动函数(Aplayer version)
    let checkAPlayerInterval = setInterval(function() {
        if (musicPlayerA) {
            clearInterval(checkAPlayerInterval);

            if (musicPlayerA.lrc) {
            
            musicPlayerA.lrc.userHovering = false;

            let scrollContainer = musicPlayerA.lrc.container.parentElement;

            if (scrollContainer) {
            scrollContainer.addEventListener('mouseenter', function() {
                    musicPlayerA.lrc.userHovering = true; // 鼠标进来了，暂停自动滚动
                });
                scrollContainer.addEventListener('mouseleave', function() {
                    musicPlayerA.lrc.userHovering = false; // 鼠标走了，恢复自动滚动
                }); 

            }

            // update函数
            musicPlayerA.lrc.update = function(currentTime = this.player.audio.currentTime) {
                
                if (this.container && !this.container.querySelector('.lrc-space')) { 
                    let space1 = document.createElement('div');
                    let space2 = document.createElement('div')
                    space1.classList.add('lrc-space');
                    space1.style.height = '30vh';
                    space2.classList.add('lrc-space');
                    space2.style.height = '15vh';

                    this.container.insertBefore(space1, this.container.firstChild);
                    this.container.appendChild(space2);
                }
                
                
                // if (this.userHovering) return;

                if (
                    this.index > this.current.length - 1 ||
                    currentTime < this.current[this.index][0] ||
                    (!this.current[this.index + 1] || currentTime >= this.current[this.index + 1][0])
                ) {
                    for (let i = 0; i < this.current.length; i++) {
                        if (
                            currentTime >= this.current[i][0] &&
                            (!this.current[i + 1] || currentTime < this.current[i + 1][0])
                        ) {
                            this.index = i;
                        
                        let currentLine = this.container.getElementsByTagName("p")[this.index];   
                        
                        if (currentLine) {
                            let preLine = this.container.getElementsByClassName("aplayer-lrc-current")[0];
                            if (preLine) preLine.classList.remove("aplayer-lrc-current");
                            currentLine.classList.add("aplayer-lrc-current");

                            let scrollContainer = this.container.parentElement;
                            let viewportHeight = scrollContainer.clientHeight;
                            let offsetTop = currentLine.offsetTop; 
                            let lineHeight = currentLine.clientHeight;

                            let targetScrollTop = offsetTop - (viewportHeight / 3) + (lineHeight / 2);
                            scrollContainer.scrollTop = targetScrollTop;

                        }
                            
                            
                    }

            }

            

        }
    }}

    }
    }, 500)


    }

    
    //修正歌词滚动函数(metingjs version)
    let checkMetingjsnterval = setInterval(function() {
            const meting = document.getElementsByTagName("meting-js")[0]

            if (meting && meting.aplayer && meting.aplayer.lrc) {
                clearInterval(checkMetingjsnterval);
                const musicPlayer = meting.aplayer;
                console.log('metingjs initialized')

                musicPlayer.lrc.userHovering = false;

                let scrollContainer = musicPlayer.lrc.container.parentElement;

                if (scrollContainer) {
                scrollContainer.addEventListener('mouseenter', function() {
                        musicPlayer.lrc.userHovering = true; // 鼠标进来了，暂停自动滚动
                    });
                    scrollContainer.addEventListener('mouseleave', function() {
                        musicPlayer.lrc.userHovering = false; // 鼠标走了，恢复自动滚动
                    }); 

                }
            
            
            bgchanger(musicPlayer);

            // update函数
            musicPlayer.lrc.update = function(currentTime = this.player.audio.currentTime) {

                // 插入占位符
            if (this.container && !this.container.querySelector('.lrc-space')) { 
                    let space1 = document.createElement('div');
                    let space2 = document.createElement('div')
                    space1.classList.add('lrc-space');
                    space1.style.height = '30vh';
                    space2.classList.add('lrc-space');
                    space2.style.height = '15vh';

                    this.container.insertBefore(space1, this.container.firstChild);
                    this.container.appendChild(space2);
                }
                    
                
                
                // if (this.userHovering) return;  // 若


                if (
                    this.index > this.current.length - 1 ||
                    currentTime < this.current[this.index][0] ||
                    (!this.current[this.index + 1] || currentTime >= this.current[this.index + 1][0])
                ) {
                    for (let i = 0; i < this.current.length; i++) {
                        if (
                            currentTime >= this.current[i][0] &&
                            (!this.current[i + 1] || currentTime < this.current[i + 1][0])
                        ) {
                            this.index = i;
                        
                        let currentLine = this.container.getElementsByTagName("p")[this.index];   
                        
                        if (currentLine) {
                            let preLine = this.container.getElementsByClassName("aplayer-lrc-current")[0];
                            if (preLine) preLine.classList.remove("aplayer-lrc-current");
                            currentLine.classList.add("aplayer-lrc-current");

                            let scrollContainer = this.container.parentElement;
                            let viewportHeight = scrollContainer.clientHeight;
                            let offsetTop = currentLine.offsetTop; 
                            let lineHeight = currentLine.clientHeight;

                            let targetScrollTop = offsetTop - (viewportHeight / 3) + (lineHeight / 2);
                            scrollContainer.scrollTop = targetScrollTop;
                    

                        }
                            
                            
                    }

                }

                

            }
        }}

    }, 500);

</script>


    <footer id="footer">
    <img src="/ico/Nemo.svg" alt="Nemophila" id="nemo-footer">
    <p>Theme <a target="_blank" rel="noopener" href="https://github.com/imouup/Nemophila"><strong>Nemophila</strong></a></p>
    <p>Powered by Love from <a href="https://nyaku.moe">izNyaku</a></p>
    <div id="footer-space"></div>
    <p>© 2021 - 2026 izNyaku. All rights reserved.</p>
    
         <a target="_blank" rel="noopener" href="https://icp.gov.moe/?keyword=20212022">萌ICP备20212022号</a>
    
       
</footer>

    
        
<script src="/js/lazyload.js"></script>
  <!-- lazyload -->
    
    
    <a id="up">
    <img src="/images/yachiyo.PNG" class="yachiyo-up no-lazy">
</a>
    
<script src="/js/up.js"></script>

    
    
    </body>
</html>